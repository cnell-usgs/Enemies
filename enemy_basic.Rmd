---
title: "Tree Diversity Effects"
author: "collnell"
date: "July 5, 2016"
output: 
  html_document:
    toc: yes
    toc_depth: 3
    toc_float: true
    theme: flatly
    highlight: tango
    fig_caption: true
    code_folding: hide
---


```{r setup, include=FALSE}
library(shiny)
library(ggplot2)
library(reshape2)
library(plotly)
library(dplyr)
library(flexdashboard)
###enter data
birds<-read.csv("enemy_bird_visit.csv")
sp.list<-read.csv("enemy_bird_list.csv")
```

```{r,datasummary}
std <- function(x) sd(x)/sqrt(length(x))

##clean data 
drops<-c("Grand.Total","X.blank.")##clean up df
birds=birds[,!(names(birds) %in% drops)]
birds[is.na(birds)]<-0
cols<-names(birds)
drops<-c("DIVERSITY","PLOT","VISIT")
sps<-cols[-c(1:3)]##this is a list of the names of the birds only
birds$VISIT<-as.character(birds$VISIT)
birds$total_abun<-rowSums(birds[,sps])


##summarize data for plots/analyses
#by plot
#abundance
bird.plot<-birds%>%
  mutate(birds_plot_visit=rowSums(.[sps]))%>%
  group_by(DIVERSITY,PLOT)%>%
  summarize(total_birds_plot=sum(birds_plot_visit),
            n_visit=length(VISIT),
            mean_birds_visit=mean(birds_plot_visit),
            se_birds_visit=std(birds_plot_visit),
            birds_30=mean_birds_visit*3,
            se_30=std(birds_plot_visit)*3)


```
#Bird Observations  
###Overall Summary  
```{r,allplot,warning=F}
birds.melt<-melt(birds,id.vars=c("DIVERSITY","PLOT","VISIT","total_abun"),variable.name="ID")%>%
  left_join(sp.list[,c("ID","feeding.guild","Family","Order")],by="ID")
```
**`r length(unique(birds.melt$PLOT))` plots**   
**`r sum(birds.melt$value)` observations**   
**`r length(unique(birds.melt$ID))` species**   
**`r length(unique(birds.melt$Family))` families**; `r sort(unique(birds.melt$Family))`  
**`r length(unique(birds.melt$Order))` orders**; `r sort(unique(birds.melt$Order))`  
```{r,insecteaters}
insect.birds<-birds.melt%>%
  filter(feeding.guild %in% c("IN","FL","OM"))
```
**Insectivorous Birds**  (including gleaners, flycatchers, and omnivores that include insects)  
**`r sum(insect.birds$value)` observations**  
**`r length(unique(insect.birds$ID))` species**  
**`r length(unique(insect.birds$Family))` families**; `r sort(unique(insect.birds$Family))`  
**`r length(unique(insect.birds$Order))` orders**; `r sort(unique(insect.birds$Order))`  

```{r insectplot}
birds.melt.guild<-birds.melt%>%
  group_by(feeding.guild)%>%
  summarize(obs=sum(value))
birds.melt.guild$feeding.guild<-reorder(birds.melt.guild$feeding.guild,birds.melt.guild$obs)

insectplot<-ggplot(birds.melt.guild,aes(x="",y=obs,fill=feeding.guild))+geom_bar(width=1,stat="identity")+theme_minimal()+scale_fill_brewer(name="Feeding Guild",palette="Set3")+labs(x="",y="")
pie<-insectplot+coord_polar("y",start=0)
pie

```
  

```{r}

abun_by_plot<-ggplot(bird.plot,aes(x=reorder(PLOT,birds_30),y=birds_30),fill=DIVERSITY)+
  geom_bar(stat="identity")+
  labs(x="Plot",y="Birds/30/plot")
abun_by_plot
plot_diff_abun<-aov(total_abun~PLOT+VISIT,data=birds)
summary(plot_diff_abun)##bird abundance varies by plot

```


#Data  
###Description
These data are from a field experiment conducted July 2015 at the [UADY forest diversity plots near Muna, Yucatan, Mexico](http://www.treedivnet.ugent.be/ExpUADY.html). Using the tree diversity manipulation we test the predictions that  
(1) tree diversity promotes the abundance and diversity of predators (insectivorous birds) and   
(2) via effects on predators, tree diversity is correlated with greater herbivore suppression.  
  
###Data sheets  
[**Bird Observations**](https://github.com/collnell/Enemies/blob/master/enemy_bird_visit.csv)  
Bird survey results from 15 minute point counts at the plot level. Each plot was visited 4 times on separate days between 0600 and 0930. These observations reflect birds actively foraging in the plots, excluding birds flying overhead or through the plot. The species of trees used by foraging birds were recorded once per individual tree. Birds that were not able to be identified definitively are recorded as species "X", or "CH X" if a partial ID was known (CH X = chipe unknown (warbler). All bird IDs match species information on the bird list.     
  
[**Bird List**](https://github.com/collnell/Enemies/blob/master/enemy_bird_list.csv)   
Inventory on all bird species recorded at the UADY diversity plots in January and July of 2015.  Contians species codes and associated information for each ID (including feeding guild).  

**Predation Experiment**  
These data are from a clay caterpillar experiment used to assay predation rates between the plots. For each experimental plot, 2 clay models were placed on opposite branches of 12 trees. Models were visited twice, 24 and 48 hours after placement, to record attack marks. Marked models were identified as either Arthropod, Bird, and Mammal and replced with a new model.  

**Experimental Design**  
Data on plots used in experiment. Plot diversity, tree species, ETC  




```{r}
bird.div<-bird.plot%>%
  group_by(DIVERSITY)%>%
  summarize(total_birds_div=sum(total_birds_plot),
            n_plots=length(PLOT),
            mean_birds_plot_30=mean(birds_30),
            se_birds_plot_30=std(birds_30),
            mean_birds_plot_visit=sum(total_birds_plot)/sum(n_visit),
            se_birds_plot_visit=std(total_birds_plot))

abun_by_div<-aov(mean_birds_visit~DIVERSITY,data=bird.plot)##plot is replicate
summary(abun_by_div)
```
<br>  
```{r,fig.height=4, fig.width=3}
div_abun_plot<-ggplot(bird.div,aes(x=DIVERSITY,y=mean_birds_plot_30,color=DIVERSITY))+
  geom_point(size=10,shape=1)+
  geom_errorbar(aes(ymin=mean_birds_plot_30-se_birds_plot_30,ymax=mean_birds_plot_30+se_birds_plot_30),color="black",width=.1)+
  labs(x="Tree Diversity",y="Birds/30/plot")+
  theme_minimal()+
  theme(legend.position="none")
div_abun_plot+geom_point(data=bird.plot,aes(x=DIVERSITY,y=birds_30),size=2)
```